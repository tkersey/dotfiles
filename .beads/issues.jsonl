{"id":".dotfiles-ule","title":"mesh: beads-native swarm orchestration (cx + jj)","description":"Goal: upgrade `codex/skills/mesh/SKILL.md` so any agent can reliably coordinate a swarm of sub-agents to complete a bead (typically an epic) using Beads primitives + cx spawning + jj workspaces.\n\nKey design constraints (decided):\n- Operate at epic-children level via `bd swarm status/validate`.\n- If given a non-epic bead, allow `bd swarm create \u003cbead\u003e` auto-wrap (1-child epic) but do NOT auto-beadify/split; if parallelism is needed, use gen-beads first.\n- Sub-agents are ephemeral and spawned via the `cx` skill.\n- No shared beads state across jj workspaces: sub-agents do NOT run `bd`; the coordinator writes bead comments + agent state.\n- Canonical coordination:\n  - assignment: `bd slot set \u003cagent\u003e hook \u003cbead\u003e`\n  - liveness: `bd agent state/heartbeat` (coordinator-updated in this mode)\n- Isolation: `jj workspace add` per bead at `../workspaces/\u003crepo\u003e/\u003cbead-id\u003e/`.\n- Done means: PR opened + coordinator records PR + verification in bead comments.\n- Scheduling: propose an ordered heuristic (priority → unlocks → checkpoints → manual), but always ask for a cap when spawning.\n\nThis epic is a planning/implementation container. Child beads should be independently PR-able, and the graph should allow parallel drafting with an explicit integration/join bead.","acceptance_criteria":"- A coherent bead graph exists under this epic with clear deps.\n- The plan yields ≥3 ready beads initially (parallel-first).\n- Every child bead has acceptance criteria + at least one verification signal.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-10T10:00:14.247902-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.247902-08:00"}
{"id":".dotfiles-ule.1","title":"mesh: contract — entrypoints, scope, target selection","description":"Define and document how the mesh coordinator chooses what to swarm.\n\nFocus:\n- Supported inputs (explicit epic ID, current bead, list of bead IDs).\n- Default behavior: epic-first; if non-epic is provided, allow `bd swarm create \u003cid\u003e` to auto-wrap into a 1-child epic.\n- Scope confirmation protocol (avoid accidental wide fanout): require the user to confirm the epic + child list before spawning.\n- Explicit statement that mesh does NOT auto-beadify (no automatic splitting into children); it expects a good DAG already.\n- Guidance for the “only one child / no parallelism” case: stop and recommend using gen-beads to create child beads + deps.\n\nDeliverable: an updated section in `codex/skills/mesh/SKILL.md` describing these contracts and the exact bd commands to use.\n\nWorkstream: Mesh Spec\nRole: contract\nParallelism impact: unlocks 3 beads\nRationale: entrypoint clarity prevents swarm misfires.","acceptance_criteria":"- `codex/skills/mesh/SKILL.md` documents:\n  - epic-first orchestration model\n  - auto-wrap behavior via `bd swarm create \u003cbead\u003e`\n  - “no auto-beadify” constraint + what to do when parallelism is missing\n  - a short, explicit scope-confirmation checklist","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:14.305423-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.305423-08:00","dependencies":[{"issue_id":".dotfiles-ule.1","depends_on_id":".dotfiles-ule","type":"parent-child","created_at":"2026-01-10T10:00:14.30869-08:00","created_by":"tk"}]}
{"id":".dotfiles-ule.2","title":"mesh: contract — scheduling + wave selection (priority→unlocks→checkpoints→manual)","description":"Define and document the mesh scheduling algorithm.\n\nDecided heuristics (in order):\n1) `bd` priority first.\n2) Maximize unlocks (prefer contract/high-fanout beads).\n3) Prefer checkpoint/integration beads when they are ready.\n4) Always allow/encourage manual pick; mesh should present a recommendation, not silently spawn.\n\nAlso capture:\n- No default concurrency cap: coordinator must ask the user per wave.\n- Wave planning from `bd swarm status` (Ready/Blocked/Active/Completed), plus optional `bd swarm validate` for “fronts”.\n- Contention rules: avoid overlapping diffs; serialize beads that touch same files; optionally mention `bd merge-slot` as a merge/conflict primitive.\n\nDeliverable: a scheduling/wave-planning section in `codex/skills/mesh/SKILL.md` with an explicit, actionable decision procedure and a status summary format.\n\nWorkstream: Mesh Scheduling\nRole: contract\nParallelism impact: unlocks 3 beads\nRationale: consistent wave selection keeps the swarm aligned.","acceptance_criteria":"- `codex/skills/mesh/SKILL.md` includes a wave-selection procedure that:\n  - uses the heuristic order: priority → unlocks → checkpoints → manual\n  - explicitly asks for a concurrency cap\n  - describes how to compute “Ready/Blocked/Active/Completed” using `bd swarm status`\n- Includes a concise “Wave status” summary template.","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:14.363291-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.363291-08:00","dependencies":[{"issue_id":".dotfiles-ule.2","depends_on_id":".dotfiles-ule","type":"parent-child","created_at":"2026-01-10T10:00:14.364047-08:00","created_by":"tk"}]}
{"id":".dotfiles-ule.3","title":"mesh: implementation — agent lifecycle via bd agent + bd slot (coordinator-only bd)","description":"Document how mesh represents and tracks sub-agents using Beads, given the “no shared beads across jj workspaces” constraint.\n\nKey behaviors to encode:\n- Coordinator creates an ephemeral agent bead per spawned sub-agent run:\n  - `bd create --type=agent --ephemeral --role-type polecat --agent-rig \u003crig\u003e ...`\n- Coordinator attaches the work bead to the agent using the hook slot:\n  - `bd slot set \u003cagent-id\u003e hook \u003cbead-id\u003e`\n- Coordinator updates agent liveness/state:\n  - `bd agent state \u003cagent-id\u003e spawning|running|working|stuck|done`\n  - `bd agent heartbeat \u003cagent-id\u003e` (optional)\n- Because sub-agents do not run `bd`, the coordinator is responsible for writing progress:\n  - per-bead comments (PR link + verification signal)\n  - epic-level “swarm status” comment aggregating PRs/blockers/next wave\n- Cleanup guidance:\n  - clear hook slot when done\n  - optionally close or delete ephemeral agent beads\n\nDeliverable: a concrete runbook section + command snippets inside `codex/skills/mesh/SKILL.md`.\n\nWorkstream: Mesh Beads Integration\nRole: implementation\nParallelism impact: unlocks 3 beads\nRationale: slots+state provide durable coordination even without shared bd access.","acceptance_criteria":"- `codex/skills/mesh/SKILL.md` includes:\n  - correct commands (`bd slot`, not `bd slots`)\n  - an explicit agent lifecycle (create → hook → state updates → coordinator logging → cleanup)\n  - a clear rule: sub-agents do not run `bd` in jj workspaces\n  - a minimal template for the coordinator’s per-bead and epic-level comments","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:14.417915-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.417915-08:00","dependencies":[{"issue_id":".dotfiles-ule.3","depends_on_id":".dotfiles-ule","type":"parent-child","created_at":"2026-01-10T10:00:14.418506-08:00","created_by":"tk"}]}
{"id":".dotfiles-ule.4","title":"mesh: implementation — jj workspace + cx dispatch recipe (per-bead workspaces)","description":"Document how mesh spins up per-bead jj workspaces and launches cx-based sub-agents in the correct working directory.\n\nDecisions:\n- Workspace path convention: `../workspaces/\u003crepo\u003e/\u003cbead-id\u003e/`.\n- Create with `jj workspace add \u003cpath\u003e [-r \u003crev\u003e]`.\n- Launch sub-agent by running `codex/skills/cx/scripts/cx-exec.sh \"...\"` FROM INSIDE the workspace so code edits land in the right working copy.\n- Sub-agent prompt must include enough bead context (copied from `bd show`) so it can work without running `bd`.\n- Sub-agent must:\n  - use `jujutsu` skill for VCS operations\n  - open a PR\n  - print a final output block the coordinator can copy into bead comments (PR URL, verification, changed paths)\n\nDeliverable: a “Workspace + Dispatch” section and an agent prompt template in `codex/skills/mesh/SKILL.md`.\n\nWorkstream: Mesh Execution\nRole: implementation\nParallelism impact: unlocks 3 beads\nRationale: consistent workspace+dispatch prevents cross-agent working-copy collisions.","acceptance_criteria":"- `codex/skills/mesh/SKILL.md` documents:\n  - exact `jj workspace add` usage and default path convention\n  - how to run `cx-exec.sh` inside the workspace\n  - a sub-agent prompt template that includes:\n    - bead context\n    - “do not run bd” rule\n    - required final output fields (PR, verify, blockers)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:14.474376-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.474376-08:00","dependencies":[{"issue_id":".dotfiles-ule.4","depends_on_id":".dotfiles-ule","type":"parent-child","created_at":"2026-01-10T10:00:14.475062-08:00","created_by":"tk"}]}
{"id":".dotfiles-ule.5","title":"mesh: checkpoint — integrate SKILL.md into cohesive end-to-end runbook + example","description":"Integrate the parallel sections into a single, coherent `codex/skills/mesh/SKILL.md` that an arbitrary agent can follow end-to-end.\n\nIntegration checklist:\n- Ensure the doc is consistent about:\n  - epic-first swarming via `bd swarm status/validate`\n  - auto-wrap behavior (`bd swarm create \u003cbead\u003e`) and its limitations\n  - no shared bd across jj workspaces (coordinator-only `bd`)\n  - jj workspace path convention + how to dispatch `cx`\n  - scheduling heuristic order: priority → unlocks → checkpoints → manual\n- Include a worked example run (commands + expected outputs) showing:\n  - selecting epic\n  - planning wave\n  - creating ephemeral agent beads + hook slots\n  - launching sub-agents\n  - recording PR+verify into beads (both epic and per-bead)\n\nThis bead is the join point that forces the whole system to read as one story.\n\nWorkstream: Mesh Integration\nRole: checkpoint\nParallelism impact: unlocks 0 beads\nRationale: frequent join points reduce drift across parallel doc edits.","acceptance_criteria":"- `codex/skills/mesh/SKILL.md` is self-contained and actionable.\n- Contains an end-to-end example run.\n- Contains at least one explicit verification signal (commands to run).\n- Does not reference non-existent commands (e.g., `bd slots`).","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-10T10:00:14.529674-08:00","created_by":"tk","updated_at":"2026-01-10T10:00:14.529674-08:00","dependencies":[{"issue_id":".dotfiles-ule.5","depends_on_id":".dotfiles-ule","type":"parent-child","created_at":"2026-01-10T10:00:14.530248-08:00","created_by":"tk"},{"issue_id":".dotfiles-ule.5","depends_on_id":".dotfiles-ule.1","type":"blocks","created_at":"2026-01-10T10:00:14.568222-08:00","created_by":"tk"},{"issue_id":".dotfiles-ule.5","depends_on_id":".dotfiles-ule.2","type":"blocks","created_at":"2026-01-10T10:00:14.606466-08:00","created_by":"tk"},{"issue_id":".dotfiles-ule.5","depends_on_id":".dotfiles-ule.3","type":"blocks","created_at":"2026-01-10T10:00:14.646175-08:00","created_by":"tk"},{"issue_id":".dotfiles-ule.5","depends_on_id":".dotfiles-ule.4","type":"blocks","created_at":"2026-01-10T10:00:14.68512-08:00","created_by":"tk"}]}
